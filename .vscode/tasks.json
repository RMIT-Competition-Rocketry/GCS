{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "middleware build-dev + generate proto",
            "type": "shell",
            "command": "mkdir -p build && cd build; cmake -DCMAKE_BUILD_TYPE=Debug .. && make -j", // VERBOSE = 1
            "options": {
                "cwd": "${workspaceFolder}" // Default?
            },
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "icon": {
                "dark": "resources/dark/build.svg",
                "light": "resources/light/build.svg",
                "color": "terminal.ansiGreen"
            },
            "problemMatcher": [
                "$gcc"
            ]
        },
        {
            "label": "middleware build-dev + generate proto + build tests",
            "type": "shell",
            "command": "mkdir -p build && cd build; cmake -DCMAKE_BUILD_TYPE=Debug -DBUILD_TESTS=ON .. && make -j", // VERBOSE = 1
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "icon": {
                "dark": "resources/dark/build.svg",
                "light": "resources/light/build.svg",
                "color": "terminal.ansiYellow"
            },
            "problemMatcher": [
                "$gcc"
            ]
        },
        {
            "label": "middleware build and test",
            "type": "shell",
            "command": "bash scripts/test_manual_cpp.sh",
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "icon": {
                "id": "check",
                "color": "terminal.ansiCyan"
            },
            "problemMatcher": [
                "$gcc"
            ]
        },
        {
            "label": "start socat manually",
            "type": "shell",
            "command": "socat -d -d pty,raw,echo=0 pty,raw,echo=0",
            "icon": {
                "id": "debug-console"
            },
            "problemMatcher": []
        },
        {
            "label": "start emulator manually",
            "type": "shell",
            "command": "./venv/bin/python -u -Xfrozen_modules=off -m backend.tools.device_emulator --device-rocket ${input:terminalPath}",
            "icon": {
                "id": "debug-console"
            },
            "problemMatcher": []
        },
        {
            "label": "start ZeroMQ debug subscriber",
            "type": "shell",
            "command": "./venv/bin/python",
            "args": [
                "backend/tools/zeromq_debug_sub_raw.py",
                "gcs_rocket"
            ],
            "icon": {
                "id": "debug-console"
            },
            "options": {
                "env": {
                    "PYTHONPATH": "${workspaceFolder}"
                }
            },
            "problemMatcher": []
        },
        {
            "label": "start frontend API manually",
            "type": "shell",
            "command": "/Users/freddy/.pyenv/versions/3.11.1/bin/python",
            "args": [
                "backend/frontend_api.py",
                "--socket-path",
                "gcs_rocket"
            ],
            "icon": {
                "id": "debug-console"
            },
            "options": {
                "env": {
                    "PYTHONPATH": "${workspaceFolder}"
                }
            },
            "problemMatcher": []
        },
        {
            "label": "start frontend API manually",
            "type": "shell",
            "command": "/Users/freddy/.pyenv/versions/3.11.1/bin/python",
            "args": [
                "backend/frontend_api.py",
                "--socket-path",
                "gcs_rocket"
            ],
            "icon": {
                "id": "debug-console"
            },
            "options": {
                "env": {
                    "PYTHONPATH": "${workspaceFolder}"
                }
            },
            "problemMatcher": []
        },
        {
            "label": "start hardware pendant emulator manually",
            "type": "shell",
            "command": "./venv/bin/python",
            "args": [
                "backend/tools/pendant_emulator.py",
            ],
            "icon": {
                "id": "debug-console"
            },
            "options": {
                "env": {
                    "PYTHONPATH": "${workspaceFolder}"
                }
            },
            "problemMatcher": []
        },
        {
            "label": "Compile Manual Protobuf Payload",
            "type": "shell",
            "command": "protoc",
            "args": [
                "-I=${workspaceFolder}/backend/proto/payloads",
                "--cpp_out=${workspaceFolder}/backend/proto/generated/payloads",
                "${workspaceFolder}/backend/proto/payloads/${input:outputPath}"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": [
                {
                    "owner": "protobuf",
                    "fileLocation": [
                        "relative",
                        "${workspaceFolder}/backend/proto/payloads"
                    ],
                    "pattern": {
                        "regexp": "^([^:]+):(\\d+):(\\d+):\\s(.*)$",
                        "file": 1,
                        "line": 2,
                        "column": 3,
                        "message": 4
                    }
                }
            ],
            "icon": {
                "id": "code"
            }
        },
        {
            "label": "Run Simulation",
            "type": "shell",
            "command": "./.venv/bin/python",
            "args": [
                "backend/simulation/run_simulation.py",
                "--device-rocket",
                "/tmp/gcs_rocket.sock"
            ],
            "options": {
                "cwd": "${workspaceFolder}",
                "env": {
                    "PYTHONPATH": "${workspaceFolder}:$PYTHONPATH"
                },
            },
            "group": "build",
            "problemMatcher": [],
            "icon": {
                "id": "rocket",
                "color": "terminal.ansiBlue"
            }
        }
    ],
    "inputs": [
        {
            "id": "outputPath",
            "type": "promptString",
            "description": "Enter the proto file path relative to backend/proto/payloads/",
            "default": "AV_TO_GCS_DATA_1.proto"
        },
        {
            "id": "terminalPath",
            "type": "promptString",
            "description": "Enter the psuedoterminal /dev path",
            "default": "/dev/ttys..."
        }
    ]
}